$.fn.handleLoadTask=function(n,t,i,r=true){$.ajax({url:"task/task-list.html",async:r,data:{projectId:n,phaseId:t},success:function(n){var t=$(".task-list-panel");t.html("");t.html(n);$(this).handleEvent();i!==null&&i()}})};$.fn.searchTask=function(){$(this).keyup(function(){var u,f,e,t,i,n,r;for(u=this,f=u.value.toUpperCase(),e=$(".task-table > table")[0],t=e.getElementsByTagName("tr"),n=0;n<t.length;n++)for(i=t[n].getElementsByTagName("td"),j=1;j<i.length;j++)if(r=i[j],r)if(r.innerText.toUpperCase().indexOf(f)>-1){t[n].style.display="";break}else t[n].style.display="none"})};var currentPhaseId=0;$.fn.loadPhase=function(){$(this).change(function(){$.showLoading();var n=$(this).val();$.ajax({url:"phase/phase-list.html",data:{projectId:n},success:function(t,i,r){var e=$(".phase-list-panel"),f,u,o;e.html("");e.html(t);f=$(".phase-list > li > a").first();u=f.attr("data-id");currentPhaseId!==null&&currentPhaseId>0&&(u=currentPhaseId);u!==0&&u!==undefined?($(this).handleLoadTask(n,u,null,!1),f.length>0&&$(".phase-list > li > a").loadTask()):$(this).handleLoadTask(n,0,null,!1);o=r.getResponseHeader("authorized-add-phase");o==="authorized"?$(".btn-addnew-phase").length<=0?$.post("phase/generate-addbutton.html",function(n){$(".project-box").append(n);$(".btn-addnew-phase").showModal();$.hideLoading()}):$.hideLoading():($(".btn-addnew-phase").remove(),$.hideLoading());currentPhaseId=0}})})};$.fn.loadTask=function(){$(this).click(function(n){n.preventDefault();var t=$(this).attr("data-id"),i=$(".project-list").val();$.showLoading();$(this).handleLoadTask(i,t,function(){$.hideLoading()})})};$.fn.refreshTask=function(){$(this).click(function(){var n=$("#phase-id").val(),t=$(".project-list").val();$(this).handleLoadTask(t,n)})};$.fn.deleteTask=function(){$(this).click(function(){var n=$(".project-list").val(),i=$("#phase-id").val(),r,t;n>0&&i>0&&(r=$(".task-table input:checkbox:checked").length>0,r?(t=[],$(".task-table input[type='checkbox']").each(function(){var n=$(this),i;n.prop("checked")&&(i=n.attr("data-id"),t.push(i))}),$.confirmDialog({title:$("#warning-title").val(),content:$("#delete-task-warning").val(),action:function(){$.showLoading();$.ajax({type:"post",url:"task/delete-task.html",data:{taskIds:t,projectId:n},success:function(){$(this).handleLoadTask(n,i);$.hideLoading()},error:function(n){$.hideLoading();$.alertDialog({title:$("#error-title").val(),content:n.responseText})}})}})):$.alertDialog({title:$("#alert-title").val(),content:$("#no-task-selected-delete-warning").val()}))})};$.fn.assignTask=function(){$(this).click(function(){var n=$(".project-list").val(),i=$("#phase-id").val(),r,t;n>0&&i>0&&(r=$(".task-table input:checkbox:checked").length>0,r?(t=[],$(".task-table input[type='checkbox']").each(function(){var n=$(this),i;n.prop("checked")&&(i=n.attr("data-id"),t.push(i))}),$.showLoading(),$.ajax({url:"task/generate-assign-view.html",type:"POST",data:{projectId:n},success:function(r){r!==""&&($(".task-template").html(""),$(".task-template").append(r),$.initCommonLib(),$.hideLoading(),$.showDialog({dialogId:"assign-task-modal",confirmAction:function(){var r=$("#selectAssignList").val();$.ajax({url:"task/assign-task.html",type:"POST",data:{taskids:t,accountId:r},success:function(){$(this).handleLoadTask(n,i)},error:function(n){$.alertDialog({title:$("#error-title").val(),content:n.responseText})}}).promise().done(function(){$.closeDialog("assign-task-modal");$.hideLoading()})}}))}})):$.alertDialog({title:$("#alert-title").val(),content:$("#no-task-selected-warning").val()}))})};$.fn.checkboxtoggle=function(){$(this).click(function(){var n=$(this).data("clicks");n?($(".task-table input[type='checkbox']").iCheck("uncheck"),$(".fa",this).removeClass("fa-check-square-o").addClass("fa-square-o")):($(".task-table input[type='checkbox']").iCheck("check"),$(".fa",this).removeClass("fa-square-o").addClass("fa-check-square-o"));$(this).data("clicks",!n)})};$.fn.handleEvent=function(){$(".search-task").searchTask();$(".checkbox-toggle").checkboxtoggle();$.registeriCheck('.task-table input[type="checkbox"]');$(".btn-addnew-task").showAddNewModal();$(".btn-delete-task").deleteTask();$(".btn-refresh-task").refreshTask();$(".task-list > tbody > tr").showEdit();$(".btn-assign-task").assignTask();$(".remove-phase").removePhase();$(".edit-phase").showModal()};$.fn.showDetailFromCode=function(){var n=$.queryString().code;n!==undefined&&n!==""&&n!==null&&$.ajax({url:"task/validate-code.html",type:"POST",data:{code:n},success:function(t){$.showLoading();$(this).handleLoadTask(t.projectId,t.phaseId,function(){$("#phase-id").val(t.phaseId);$(".project-list").val(t.projectId);$.hideLoading();$('.task-list > tbody > tr[data-code="'+n+'"]').trigger("click")})},error:function(){window.location.href="/"}})};$(function(){$(".project-list").loadPhase();$(".phase-list > li > a").loadTask();$(this).handleEvent();$(this).showDetailFromCode()});