$.fn.handleLoadTask=function(n,t,i,r=true){$.ajax({url:"task/task-list.html",async:r,data:{projectId:n,phaseId:t},success:function(n){var t=$(".task-list-panel");t.html("");t.html(n);$(this).handleEvent();i!==null&&i()}})};$.fn.searchTask=function(){$(this).keyup(function(){var u,f,e,t,i,n,r;for(u=this,f=u.value.toUpperCase(),e=$(".task-table > table")[0],t=e.getElementsByTagName("tr"),n=0;n<t.length;n++)for(i=t[n].getElementsByTagName("td"),j=1;j<i.length;j++)if(r=i[j],r)if(r.innerText.toUpperCase().indexOf(f)>-1){t[n].style.display="";break}else t[n].style.display="none"})};$.fn.loadPhase=function(){$(this).change(function(){var n=$(this).val();$.showLoading();$.ajax({url:"phase/phase-list.html",data:{projectId:n},success:function(t,i,r){var f=$(".phase-list-panel"),e,u,o;f.html("");f.html(t);e=$(".phase-list > li > a").first();u=e.attr("data-id");u!==0&&($(this).handleLoadTask(n,u,null,!1),$(".phase-list > li > a").loadTask());o=r.getResponseHeader("authorized-add-phase");o==="authorized"?$(".btn-addnew-phase").length<=0?$.post("phase/generate-addbutton.html",function(n){$(".project-box").append(n);$(".btn-addnew-phase").showModal();$.hideLoading()}):$.hideLoading():($(".btn-addnew-phase").remove(),$.hideLoading())}})})};$.fn.loadTask=function(){$(this).click(function(n){n.preventDefault();$.showLoading();var t=$(this).attr("data-id"),i=$(".project-list").val();$(this).handleLoadTask(i,t,function(){$.hideLoading()})})};$.fn.refreshTask=function(){$(this).click(function(){var n=$("#phase-id").val(),t=$(".project-list").val();$(this).handleLoadTask(t,n)})};$.fn.deleteTask=function(){$(this).click(function(){var t=$(".task-table input:checkbox:checked").length>0,n;t?(n=[],$(".task-table input[type='checkbox']").each(function(){var t=$(this),i;t.prop("checked")&&(i=t.attr("data-id"),n.push(i))}),$.confirmDialog({title:$("#warning-title").val(),content:$("#delete-task-warning").val(),action:function(){$.showLoading();$.ajax({type:"post",url:"task/delete-task.html",data:{taskIds:n,projectId:$(".project-list").val()},success:function(){var n=$("#phase-id").val(),t=$(".project-list").val();$(this).handleLoadTask(t,n);$.hideLoading()},error:function(){}})}})):$.alertDialog({title:$("#alert-title").val(),content:$("#no-task-selected-delete-warning").val()})})};$.fn.assignTask=function(){$(this).click(function(){var i=$(".task-table input:checkbox:checked").length>0,n,t;i?(n=[],$(".task-table input[type='checkbox']").each(function(){var t=$(this),i;t.prop("checked")&&(i=t.attr("data-id"),n.push(i))}),t=$(".project-list").val(),$.showLoading(),$.ajax({url:"task/generate-assign-view.html",type:"POST",data:{projectId:t},success:function(t){$(".task-template").html("");$(".task-template").append(t);$.initCommonLib();$.hideLoading();$.showDialog({dialogId:"assign-task-modal",confirmAction:function(){var t=$("#selectAssignList").val();$.ajax({url:"task/assign-task.html",type:"POST",data:{taskids:n,accountId:t},success:function(){var n=$("#phase-id").val(),t=$(".project-list").val();$(this).handleLoadTask(t,n)}}).promise().done(function(){$.closeDialog("assign-task-modal");$.hideLoading()})}})}})):$.alertDialog({title:$("#alert-title").val(),content:$("#no-task-selected-warning").val()})})};$.fn.checkboxtoggle=function(){$(this).click(function(){var n=$(this).data("clicks");n?($(".task-table input[type='checkbox']").iCheck("uncheck"),$(".fa",this).removeClass("fa-check-square-o").addClass("fa-square-o")):($(".task-table input[type='checkbox']").iCheck("check"),$(".fa",this).removeClass("fa-square-o").addClass("fa-check-square-o"));$(this).data("clicks",!n)})};$.fn.handleEvent=function(){$(".search-task").searchTask();$(".checkbox-toggle").checkboxtoggle();$.registeriCheck('.task-table input[type="checkbox"]');$(".btn-addnew-task").showAddNewModal();$(".btn-delete-task").deleteTask();$(".btn-refresh-task").refreshTask();$(".task-list > tbody > tr").showEdit();$(".btn-assign-task").assignTask();$(".remove-phase").removePhase();$(".edit-phase").showModal()};$.fn.showDetailFromCode=function(){var n=$.queryString().code;n!==undefined&&n!==""&&n!==null&&$.ajax({url:"task/validate-code.html",type:"POST",data:{code:n},success:function(){$('.task-list > tbody > tr[data-code="'+n+'"]').trigger("click")},error:function(){window.location.href="/"}})};$(function(){$(".project-list").loadPhase();$(".phase-list > li > a").loadTask();$(this).handleEvent();$(this).showDetailFromCode()});